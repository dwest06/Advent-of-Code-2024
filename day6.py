# from pprint import pprint
imap = """....#.....
.........#
..........
..#.......
.......#..
..........
.#..^.....
........#.
#.........
......#..."""

imap2 = """.....................#................#...#.....#.................................................#...........#...................
.............#....#.#.................................#....................................................#.........#............
...........................................#...................................................................#......#...........
....................................................#................#.......#.............#......................................
..........................................#...##.#....................................#....#.........#............................
....................................#.............................................#.......#................#.......###............
..##.......#......................#..#........................................................#...................#...............
.....#...........#..................................#..............#...........#..................................................
..........#..#......#.....#..#........#..................#.............................#...........................##............#
..............................#....#..........#...................................................................................
.......#.#..........................#.........#...##..........................................................#.#....#...#.#......
..............................................................................................................#.........#.........
....................#......#.....#...............................#..#.........#........................#.#.....#..................
......................................##.................#.....................#............#.#.#..............#...............#..
#...........................#..................#.....#..#..#.............#......#.........#........#........#.#.#.................
.......#.............#....................#.................#...#.........#.......#................#......#................#....#.
...............#.................................................#................#..................#..................#.........
.........#....................#..............................#..............#..............#.......#....................#......#..
....................................##.............................................................................#.#............
.....................................................................#...#.#........................#....#....#......#............
.....#...........................#.........#.............................................................................#........
...............#.#.........#...............##..............................................#............#.........................
#..............#....##....#............#...#.#............................#...................................#..#..............#.
........#.........#...........................................................#..............................................#....
.........................................................................................#.......#................................
................................#.........#..........#..#.......................................#..............................#..
........................#.................................................................................##........#.............
.....#.....................#.....................#...#...........#.........................#......................................
....................................................................................................#.............................
.........#...................................#...#................................................................................
..............#............##......#..............#......................................................#.....................#..
..#.......#............................................................................#...#.....................#................
..................#.....................##..#.................#..........#.....#........#.............#............#...........#..
...................................#.....#..............#..#.............................................#.....#......#....#......
......#....#.....................................................#................#...............................#...............
..#.#..................#.......#......#.............#.......#.....................................................................
......##...........................#.................#.....#........................................#.............................
...#......................#...............##......#.......................#..........#.................#.......#.......#..........
...........................#.............................................................#.#................#......#..#...........
..#.............#.....#.........................................................#..........#......................................
...........#.........#..........................................................................#..............#..................
.#.......................................................#.#.......#............................................#.#...............
..........................#....#...............#............................................................#.........#...........
.........................##.........#^.....................................................#......................................
........#.......#.................................................................................................#.......#.......
..........#..................................##..#.......................#.................#....................................#.
...................................#..#.....#.#.............#.....#.................##..............#.............................
...........................................................#.........................................................#......#.....
............#.........................#.........#.................................................................................
................#.........................#...............................#.......................................................
.....................#.......#.................#.#..............#...............#.................................................
...#......................#...............................#.......#.......#..........................................#............
.........#..#............................................................................................#........................
..............................................................................................#.#...........#.........#...........
..#..............#...............#.................................................................#.....#........................
................#..........#.......##..............#..............................#.##......#.....................................
.........#....#.#..................................................................#...................#..........................
#...#............#...............................................................................................................#
........#.....#.#................#.........................#.........#...........................##........................#.#....
......#...#.....................................................................#...........................#.....................
........#.........#.....................#............................................................................#..........#.
.................................................................#....................#.........#..#...#.##.......................
..........#...........................##.......#...................................................................#.#............
.......................................................................................#.................#..#.#...................
............................................................................................#.............#.......................
........................#........................#.................#..........................#...........................#.......
.....................................#......#.................................#..........#........................................
....#...............................#........#............................#............................#..........................
..........#................#.#....................................................................................................
#........................................................................#..........................................#.....#.......
.#....................................#.........#..#.#...................................................#........................
...................#....................#..............#..................#.................................................#.....
.........................................................................#..........................#............#................
........................................................#.................................................................#.......
#...........................................#..............#............................................................#..#......
...............#..............#...............#............................#.......#.............#....#...........................
......#............#.#...........................................................................................#................
..................#..#.......#..............................#.............................#........#.......#.........#...........#
...............#.....................................#......#....................................#..........#................#....
.............................................#...............#...........#........#.............#...#.......................##....
.....#..................#...........#..............#.............#....................................#.........#.................
........................#.......................................................................#...........#.....................
.............................#.....................................................#........##....................................
...........#.................................................................................#.........#....#....#.....#..........
.....#..................................................................................#.....#.............................#....#
..#........#...............#.........................................................#.......#........................#.........#.
..............................................#....................##..............................#..........#.......#.#......#..
.......................#......................................................#........#..........................................
..#.........................................#...........#.........................................................#...............
..........................#.......#...............................................................................................
.........#.....................#..............................................#...............#...................................
..............................................#.........#..........#....#..............#..........................................
......................................#.........#............#........................................................#...#.......
...........................................#.....#..................#.....#..........#...............#...#........................
.......................#........#..........................................................#.......#.........#............#....#..
..........#.....................................................................#...#.......#.......#.........#.....#.............
.............................#..#...............................#....#.................................................#..#.......
.#.............#................##......................................#...#..............................#............#.........
....#.........#....#..................................................................................#...............#.....#.....
......#................................................#.....#.#.......#.......#....................#.............#...............
...............................#..........#........................#.......................................................#.....#
...............#.......................................................................................#......#.......#..#.#.#....
..#....#.........................................................................#...................#....................##......
...........................#......#.................#...#..........................#..............................................
......#..........#...#............#....#..........................................................................................
.......................#......#...............#..#......................#......#........................#........................#
.#............#................................#............#....................#.................................#..............
................#.........#.................###............#..#...............#..............................#...#................
......#..........................#....#............#.................#...................................................#........
..........................#...#.............#........#......................#......................#.#.............#............#.
............................#................#....................#....##.......................#........#..........##.....#......
..............#.#...................#.#.............................................#..........#......#...........................
.....#.........................#...........#...#......................................#......#..........#.#....#.##...............
.............##.##....................................................................#.#..............#.......#.....#..#...#.....
#.......#..................#.........#...................#................#..##...............##...............#..................
..............#....#........#.....#.................................#....#....#...#.......................................#.......
...........................#......#..............................#......................#.........................................
.................#.#..........##................#...#..................................#..............#.....#.................#...
..........................#..............#..#......................#.......................#...........##.........................
..#...................#..........#.......#..........#...............................#.....................#.......................
............#......................#................#....#......................#.................................................
...........................................#........#.........#..........#..................#....#.........#....##................
..........#........................#.#...............#............................................#........#...#.....#............
...............#..........#..........#...#.....#........................#..............#..#.....................##................
...#.......................##.....................#................................................#..#............#..............
....#........#..#...#.#............................#................#................#............................................
...........#....................#.....#.........................#....................#.............#....#.........#...#........##.
.#.....#.................##............#...............................#...............#.......................##.................
..............................#................................#.............................#................#.#.................
............##..............#........#.......#...................#..........................#.............###..#...#............#."""


def read_map(imap):
    return [list(i) for i in imap.split('\n')]

def printimap(imap):

    print("  ", end='')
    for i in range(len(imap)):
        print(f"Y{i} ", end="")

    print('')
    for index, i in enumerate(imap):
        print(f"X{index}", end='')
        for k, j in enumerate(i):
            print(f" {j} ", end='')
        print('')


def calculate_position(imap):
    # Find the starting position
    init_x, init_y = 0, 0
    orientation = None
    for i in range(len(imap)):
        for j in range(len(imap[i])):
            if imap[i][j] == '^' or imap[i][j] == 'v' or imap[i][j] == '<' or imap[i][j] == '>':
                init_x, init_y = i, j
                orientation = imap[i][j]
                break

    x, y = init_x, init_y
    new_blocks = 0
    while x > 0 and x < (len(imap) -1) and y > 0 and y < (len(imap) - 1):

        # Go forward
        if orientation == '^':
            
            # print(f"X: {x}, Y: {y}")
            for i in range(y + 1, len(imap)):
                # print(f"Y: {i}")
                if imap[x][i] == '#':
                    break
                if imap[x][i] == '+' and imap[x][i+1] == '#':
                    # print(f"New Block X: {x} Y: {i}")
                    new_blocks += 1
                    break

            if imap[x - 1][y] == '#':
                # Turn right
                orientation = '>'
                imap[x][y] = '+'
                y += 1
                imap[x][y] = orientation
            else:
                imap[x][y] = 'X'
                x -= 1
                imap[x][y] = '^'

        elif orientation == '>':

            # print(f"X: {x}, Y: {y}")
            for i in range(x + 1, len(imap)):
                # print(f"X: {i}")
                if imap[i][y] == '#':
                    break
                if imap[i][y] == '+' and imap[i + 1][y] == '#':
                    # print(f"New Block X: {i} Y: {y}")
                    new_blocks +=1
                    break

            if imap[x][y + 1] == '#':
                # Turn down
                orientation = 'v'
                imap[x][y] = '+'
                x += 1
                imap[x][y] = orientation
            else:
                imap[x][y] = 'X'
                y += 1
                imap[x][y] = '>'

        elif orientation == 'v':

            # print(f"X: {x}, Y: {y}")
            for i in range(y - 1, 0, -1):
                # print(f"Y: {i}")
                if imap[x][i] == '#':
                    break
                if imap[x][i] == '+' and imap[x][i - 1] == '#':
                    # print(f"New Block X: {x} Y: {i}")
                    new_blocks += 1
                    break

            if imap[x + 1][y] == '#':
                # Turn left
                orientation = '<'
                imap[x][y] = '+'
                y -= 1
                imap[x][y] = orientation
            else:
                imap[x][y] = 'X'
                x += 1
                imap[x][y] = 'v'

        elif orientation == '<':

            # print(f"X: {x}, Y: {y}")
            for i in range(x - 1, 0, -1):
                # print(f"X: {i}")
                if imap[i][y] == '#':
                    break
                if imap[i][y] == '+' and imap[i-1][y] == '#':
                    # print(f"New Block X: {i} Y: {y}")
                    new_blocks += 1
                    break

            if imap[x][y - 1] == '#':
                # Turn up
                orientation = '^'
                imap[x][y] = '+'
                x -= 1
                imap[x][y] = orientation
            else:
                imap[x][y] = 'X'
                y -= 1
                imap[x][y] = '<'

        # printimap(imap)
        # print(orientation, new_blocks)
        # print(input())

    # Final X
    imap[x][y] = 'X'

    # #################
    # pprint(imap)
    # print(new_blocks)

    # Count X
    count = 0
    for i in imap:
        for j in i:
            if j == 'X' or j == '+':
                count += 1
    return count, new_blocks


print(calculate_position(read_map(imap)))

